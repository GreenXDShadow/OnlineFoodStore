<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dairy and Eggs</title>
  <!-- icon library and stylesheet reference -->
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
</head>

<body>
  <div class="overlay"></div>
  <div class="topnav">
    <a href="{{ url_for('index') }}"><i class="fa fa-fw fa-home"></i> Home</a>
    <form>
      <input class="searchbar" type="search" placeholder="search for products <3">
    </form>
    <div class="imageRight">
      <button class="user-icon-btn" onclick="toggleDropdown()">
        <img src="{{ url_for('static', filename='Icons/user.png')}}" alt="user" class="user-icon" width="27px"
          height="27px">
    </div></button>
    <div class="dropdown-content hidden" id="myDropdown">
      <button class="user-icon-btn" onclick="toggleDropdown()"><i class="fa fa-times fa-xs fa-fw imageRight"
          style="font-size: 2em;"></i></button>
      <h2>ACCOUNT</h2>
      <div id="oneline">
        <h4>Register</h4>
        <button id="loginButton" class="user-icon-btn" onclick=registrationPopUp()>
          <img class="arrow-level" src="{{ url_for('static', filename='Icons/down.png')}}" alt="downarrow" width="20px"
            height="20px">
        </button>
      </div>
      <div class="form-popup" id="register">
        <form action="/api/addUser" method="post" class="form-container" id="popUpForm">
          <h2>Registration</h2>
          <div class="input-container">
          <i class="fa fa-fw fa-user"></i>
          <input type="text" id="userName" name="name" placeholder="Username">
          </div>
          <div class="input-container">
          <i class="fa fa-fw fa-lock"></i>
          <input type="password" id="passWord" name="password" placeholder="Password">
          </div>
          <div class="input-container">
          <i class="fa fa-fw fa-lock"></i>
          <input type="password" id="confirmPassWord" name="confirm_password" placeholder="Confirm Password">
          </div>
          <div class="input-container">
          <i class="fa fa-fw fa-envelope"></i>
          <input type="email" id="email" name="email" placeholder="Email Address">
          </div>
          <br>
          <input type="submit" value="Submit">
        </form>
      </div>
      <div id="oneline">
        <h4>Log In</h4>
        <button id="loginButton" class="user-icon-btn" onclick=loginPopUp()>
          <img class="arrow-level" src="{{ url_for('static', filename='Icons/down.png')}}" alt="downarrow" width="20px"
            height="20px">
        </button>
      </div>
      <div class="form-popup" id="login">
        <form action="example.com/path" class="form-container" id="popUpForm">
          <h2>Log In</h2>
          <div class="input-container">
          <i class="fa fa-fw fa-user"></i>
          <input type="text" id="userName" placeholder="Username">
        </div>
        <div class="input-container">
          <i class="fa fa-fw fa-lock"></i>
          <input type="password" id="passWord" placeholder="Password">
          </div>
          <br>
            <input type="submit" value="Submit">
        </form>
      </div>
      <a href="{{ url_for('adminlogin') }}">
        <h4>Admin Login</h4>
      </a>
    </div>
    <button class="cart-icon-btn" onclick="window.location.href = '{{ url_for('cart') }}';">
      <img src="{{ url_for('static', filename='Icons/cart.png')}}" alt="user" class="user-icon" width="27px"
        height="27px">
  </div></button>
  </div>
  </div>
  <div class="bottomnav">
    <ul>
      <li><a href="{{ url_for('categories') }}">Select Category</a></li>
      <li><a href="#">New Products</a></li>
      <li><a href="{{ url_for('featured') }}">Featured Products</a></li>
      <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
    </ul>
  </div>
  <h1 style="margin-left:18%;">Dairy Products:</h1>
  <div class="row">
  {% for product in products %} <!-- Start iterating over the products list -->
    <div class="icon">
      <!-- Display product image -->
      <img src="{{ url_for('static', filename=product.imagePath) }}" alt="{{ product.name }}" width="80px" height="80px">

      <!-- Display product name -->
      <h3>{{ product.name }}</h3>

      <!-- Display price per unit or per pound based on product type -->
      <div class="productPrice">
        {% if product.type == 'packaged' %}
          Price per unit: ${{ '%.2f'|format(product.price) }}
        {% elif product.type == 'fresh' %}
          Price per pound: ${{ '%.2f'|format(product.price) }}
        {% endif %}
      </div>

      {% if session.logged_in %}
      <!-- Add to Cart form, visible only when user is logged in -->
      <form class="add-to" method="POST" action="/api/addToCart" onsubmit="addToCart(event, this)">
        <input type="number" name="quantity" value="1" min="1" width="80px">
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <br>
        <!-- Button to confirm the quantity change -->
        <button type="submit" class="confirm">
          <img src="{{ url_for('static', filename='Icons/check.png')}}" alt="check Icon" style="width: 16px; height: 16px;">
        </button>
        <!-- Display success message -->
        <span class="success-message" style="display: none;"></span> <!-- Success message -->
      </form>
      {% endif %}
    </div>

    {% if loop.index % 4 == 0 and not loop.last %} <!-- Check if the product is the fourth in a row and not the last product -->
      </div><div class="row"> <!-- Close the current row and start a new one -->
    {% endif %}
  {% endfor %} <!-- End of products iteration -->

</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>

<script>
function addToCart(event, form) {
  event.preventDefault(); // Prevent default form submission

  // Get the form data
  var formData = new FormData(form);

  // AJAX request to server
  fetch('/api/addToCart', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'success') {
      // Display success message
      var successMessage = form.querySelector('.success-message');
      successMessage.innerText = 'Item added successfully';
      successMessage.style.display = 'block';

      // Hide the message after 3 seconds
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 3000);
    }
  })
  .catch(error => console.error('Error:', error));
}
</script>
